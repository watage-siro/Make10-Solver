      - name: Run benchmark on generated inputs
        run: |
          mkdir -p bench/results
          # ヘッダー作成
          echo "input,run1_calls,run1_ops,run1_evals,run1_time,run2_calls,run2_ops,run2_evals,run2_time,run3_calls,run3_ops,run3_evals,run3_time,run4_calls,run4_ops,run4_evals,run4_time,run5_calls,run5_ops,run5_evals,run5_time,avg_calls,avg_ops,avg_evals,avg_time,min_calls,max_calls,min_time,max_time" > bench/results/results.csv

          for input in bench/inputs/*.txt; do
            results=()

            for i in $(seq 1 5); do
              out=$(./make10 < "$input")
              # 出力が "calls ops evals time" のスペース区切りであると想定
              results+=($out) 
            done

            # Pythonで統計計算
            # resultsには [c1, o1, e1, t1, c2, o2, e2, t2, ...] の順で入る
            line=$(python3 - "${results[@]}" <<'PY'
import statistics, sys
data = sys.argv[1:]
# 数値に変換
calls = [int(x) for x in data[0::4]]
ops   = [int(x) for x in data[1::4]]
evals = [int(x) for x in data[2::4]]
times = [float(x) for x in data[3::4]]

# 出力用リスト作成: 個別の値(c1,o1,e1,t1, c2,o2,e2,t2...) + 統計値
output = []
for i in range(5):
    output.extend([calls[i], ops[i], evals[i], times[i]])

output.extend([
    statistics.mean(calls), statistics.mean(ops), statistics.mean(evals), statistics.mean(times),
    min(calls), max(calls), min(times), max(times)
])

print(",".join(map(str, output)))
PY
)
            echo "$(basename "$input"),$line" >> bench/results/results.csv
          done
